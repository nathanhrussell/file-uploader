<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üìÅ Folder Files</title>
</head>
<body>
  <h1>üìÅ Folder Files</h1>
  <p id="message" style="font-weight: bold;"></p>

  <table border="1" id="fileTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Size (KB)</th>
        <th>Uploaded</th>
        <th>Download</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const message = document.getElementById("message");
    const tableBody = document.querySelector("#fileTable tbody");

    // Extract folder ID from ?id=123
    const params = new URLSearchParams(window.location.search);
    const folderId = params.get("id");

    if (!folderId) {
      message.textContent = "Folder ID missing from URL.";
    } else {
      fetch(`/folders/${folderId}/files`, {
        credentials: "include"
      })
        .then(res => res.json())
        .then(files => {
          if (!Array.isArray(files)) {
            message.textContent = "Error loading files.";
            return;
          }

          if (files.length === 0) {
            tableBody.innerHTML = "<tr><td colspan='4'>No files found in this folder.</td></tr>";
            return;
          }

          files.forEach(file => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${file.name}</td>
              <td>${(file.size / 1024).toFixed(2)}</td>
              <td>${new Date(file.uploadTime).toLocaleString()}</td>
              <td><a href="/files/${file.id}/download">Download</a></td>
            `;
            tableBody.appendChild(row);
          });
        })
        .catch(() => {
          message.textContent = "Failed to fetch files.";
        });
    }
  </script>
</body>
</html>
