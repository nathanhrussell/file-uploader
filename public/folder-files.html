<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folder Contents</title>
</head>
<body>
    <h1>üìÅ Folder Files</h1>
    <p> id="message" style="font-weight: bold;"</p>

    <table border="1" id="fileTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Size (KB)</th>
                <th>Uploaded</th>
                <th>Download</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script src="/js/navbar.js"></script>
    <script src="/js/message.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const folderId = ("id");

        if (!folderId) {
            document.getElementById("message").textContent = "Missing folder ID in URL.";
            throw new Error("Missing folder ID");
        }

        fetch(`/folders/${folderId}/files`, {credentials: "include" })
        .then(res => {
            if (!res.ok) {
                throw new Error("Failed to fetch files");
            }
            return res.json();
        })
        .then(files => {
            const tbody = document.querySelector("#fileTable tbody");

            if (files.length === 0) {
                document.getElementById("message").textContent = "This folder has no files.";
                return;
            }

            files.forEach(file => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${file.name}</td>
                    <td>${(file.size / 1024)}.toFixed(2)}</td>
                    <td>${new Date(file.uploadTime).toLocaleString()}</td>
                    <td><a href="/files/${file.id}/download">Download</a></td>
                `;
                tbody.appendChild(row);
            });
        })
        .catch (err => {
            console.error(err);
            document.getElementById("message").textContent = "Failed to load folder files";
        });
    </script>
</body>
</html>